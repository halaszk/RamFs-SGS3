#!/system/bin/sh

sleep 30
echo "Start working";
PERSEUS_TWEAKS()
{
#GPU tweaks

#freq_table
echo "Previous freq table settings:"
cat /sys/devices/system/gpu/freq_table
echo "54 108 160 266 350 440 533 640 733 800" > /sys/devices/system/gpu/freq_table

echo "New freq table settings:"
cat /sys/devices/system/gpu/freq_table

#volt_table
echo "Previous volt table settings:" 
cat /sys/devices/system/gpu/volt_table

#echo "775 825 875 925 975 1025 1125 1150 1175 1200" > /sys/devices/system/gpu/volt_table
echo "675 700 750 825 875 975 1075 1125 1175 1200" > /sys/devices/system/gpu/volt_table
echo "New volt table settings:"
cat /sys/devices/system/gpu/freq_table

#Max and Min Freq
echo "Previous max settings:"
cat /sys/devices/system/gpu/max_freq
echo "Previous min settings:"
cat /sys/devices/system/gpu/min_freq
echo "800" > /sys/devices/system/gpu/max_freq
echo "54" > /sys/devices/system/gpu/min_freq

echo "New max settings:"
cat /sys/devices/system/gpu/max_freq
echo "New min settings:"
cat /sys/devices/system/gpu/min_freq
#Thresholds
echo "Previous thresholds settings:"
cat /sys/devices/system/gpu/thresholds
echo "85 20" > /sys/devices/system/gpu/thresholds
echo "New thresholds settings:"
cat /sys/devices/system/gpu/thresholds

echo "1" /sys/devices/system/gpu/time_in_state

# ------------------------------Undervolt------------------------------
#UV_BEGIN#
# CPU Voltage Modify
# Modifica voltaggio per ogni frequenza (1500 max, 750 min)
echo "Previous CPU UV settings:"
cat /sys/devices/system/cpu/cpu0/cpufreq/UV_mV_table
echo "Set UV"
echo "1300 1300 1275 1213 1175 1138 1075 1025 975 925 875 863 850 838 825 800 800" > /sys/devices/system/cpu/cpu0/cpufreq/UV_mV_table
echo "New CPU UV settings:"
cat /sys/devices/system/cpu/cpu0/cpufreq/UV_mV_table
#UV_END
##HANG cuccok

# Scoobydoo enabled (0/1)
echo "1" > /sys/class/misc/scoobydoo_sound_control/enable

# Negative digital gain in dB (0 - 12)
echo "0" > /sys/class/misc/scoobydoo_sound/digital_gain

# Headphone amplification in dB offset by 57, e.g. 0 is -57 dB, 60 is 3 dB (0 - 63)
echo "60" > /sys/class/misc/scoobydoo_sound/headphone_amplifier_level

echo 1 A 0x0FBB > /sys/class/misc/scoobydoo_sound/headphone_eq_bands_values

echo 1 B 0x0407 > /sys/class/misc/scoobydoo_sound/headphone_eq_bands_values

echo 1 PG 0x0114 > /sys/class/misc/scoobydoo_sound/headphone_eq_bands_values

echo 2 A 0x1F8C > /sys/class/misc/scoobydoo_sound/headphone_eq_bands_values

echo 2 B 0xF073 > /sys/class/misc/scoobydoo_sound/headphone_eq_bands_values

echo 2 C 0x040A > /sys/class/misc/scoobydoo_sound/headphone_eq_bands_values

echo 2 PG 0x01C8 > /sys/class/misc/scoobydoo_sound/headphone_eq_bands_values

# Headphone equalizer enabled (0/1)
echo "1" > /sys/class/misc/scoobydoo_sound/headphone_eq

# Equalizer bands in dB (-12 - 12)
echo "4" > /sys/class/misc/scoobydoo_sound/headphone_eq_b1_gain

echo "2" > /sys/class/misc/scoobydoo_sound/headphone_eq_b2_gain

echo "0" > /sys/class/misc/scoobydoo_sound/headphone_eq_b3_gain

echo "2" > /sys/class/misc/scoobydoo_sound/headphone_eq_b4_gain

echo "3" > /sys/class/misc/scoobydoo_sound/headphone_eq_b5_gain

# 3D stereo expansion effect enabled (0/1)
echo "1" > /sys/class/misc/scoobydoo_sound/stereo_expansion

# 3D stereo expansion effect gain (0 - 31)
echo "4" > /sys/class/misc/scoobydoo_sound/stereo_expansion_gain

# Force mono enabled (0/1)
echo "0" > /sys/class/misc/scoobydoo_sound/mono_downmix

# DAC direct enabled (0/1)
echo "1" > /sys/class/misc/scoobydoo_sound/dac_direct

# FLL tuning enabled (0/1)
echo "1" > /sys/class/misc/scoobydoo_sound/fll_tuning

# DAC oversampling enabled (0/1)
echo "1" > /sys/class/misc/scoobydoo_sound/dac_osr128

# Speaker tuning enabled (0/1) - better bass response on main speakers
echo "0" > /sys/class/misc/scoobydoo_sound/speaker_tuning

# Speaker amplification offset (-6 - 6) 
echo "0" > /sys/class/misc/scoobydoo_sound/speaker_offset

# These could not be controlled in STweaks from what I understand

# Some other kind of oversampling I guess
echo "0" > /sys/class/misc/scoobydoo_sound/adc_osr128

# Obviously related to speaker tuning but I have no idea really
echo "44" > /sys/class/misc/scoobydoo_sound/speaker_tuning_level


}

#saj�t cuccok
FILE_NAME=S96halaszk;

# default settings (1000 = 10 seconds)
dirty_expire_centisecs_default=1000;
dirty_writeback_centisecs_default=1000;

# battery settings
dirty_expire_centisecs_battery=0;
dirty_writeback_centisecs_battery=0;

# =========
# Renice - kernel thread responsible for managing the swap memory and logs
# =========
renice 15 -p `pidof kswapd0`;
renice 15 -p `pgrep logcat`;

# ==============================================================
# I/O-TWEAKS
# ==============================================================
IO_TWEAKS()
{
MMC=`ls -d /sys/block/mmc*`;
ZRM=`ls -d /sys/block/zram*`;
scheduler=deadline;

for z in $ZRM; do

if [ -e $i/queue/rotational ]; then
echo "0" > $i/queue/rotational;
fi;

if [ -e $i/queue/iostats ]; then
echo "0" > $i/queue/iostats;
fi;

if [ -e $i/queue/rq_affinity ]; then
echo "1" > $i/queue/rq_affinity;
fi;

if [ -e $i/queue/read_ahead_kb ]; then
echo "512" > $i/queue/read_ahead_kb;
fi;

if [ -e $i/queue/max_sectors_kb ]; then
echo "512" > $i/queue/max_sectors_kb; # default: 127
fi;

done;

for i in $MMC; do

if [ -e $i/queue/scheduler ]; then
echo $scheduler > $i/queue/scheduler;
fi;

if [ -e $i/queue/rotational ]; then
echo "0" > $i/queue/rotational;
fi;

if [ -e $i/queue/iostats ]; then
echo "0" > $i/queue/iostats;
fi;

if [ -e $i/queue/read_ahead_kb ]; then
echo "2048" > $i/queue/read_ahead_kb; # default: 128
fi;

if [ -e $i/queue/max_sectors_kb ]; then
echo "512" > $i/queue/max_sectors_kb; # default: 512
fi;

if [ -e $i/queue/nr_requests ]; then
echo "64" > $i/queue/nr_requests; # default: 128
fi;

if [ -e $i/queue/iosched/writes_starved ]; then
echo "1" > $i/queue/iosched/writes_starved;
fi;

if [ -e $i/queue/iosched/back_seek_max ]; then
echo "16384" > $i/queue/iosched/back_seek_max; # default: 16384
fi;

if [ -e $i/queue/iosched/max_budget_async_rq ]; then
echo "2" > $i/queue/iosched/max_budget_async_rq; # default: 4
fi;

if [ -e $i/queue/iosched/back_seek_penalty ]; then
echo "1" > $i/queue/iosched/back_seek_penalty; # default: 2
fi;

if [ -e $i/queue/iosched/fifo_expire_sync ]; then
echo "125" > $i/queue/iosched/fifo_expire_sync; # default: 125
fi;

if [ -e $i/queue/iosched/fifo_expire_async ]; then
echo "250" > $i/queue/iosched/fifo_expire_async; # default: 250
fi;

if [ -e $i/queue/iosched/timeout_async ]; then
echo "2" > $i/queue/iosched/timeout_async; # default: HZ / 25
fi;

if [ -e $i/queue/iosched/slice_idle ]; then
echo "2" > $i/queue/iosched/slice_idle; # default: 8
fi;

if [ -e $i/queue/iosched/quantum ]; then
echo "8" > $i/queue/iosched/quantum; # default: 4
fi;

if [ -e $i/queue/iosched/slice_async_rq ]; then
echo "2" > $i/queue/iosched/slice_async_rq; # default: 2
fi;

if [ -e $i/queue/iosched/fifo_batch ]; then
echo "1" > $i/queue/iosched/fifo_batch;
fi;

if [ -e $i/queue/iosched/rev_penalty ]; then
echo "1" > $i/queue/iosched/rev_penalty;
fi;

if [ -e $i/queue/iosched/low_latency ]; then
echo "1" > $i/queue/iosched/low_latency;
fi;

done;

if [ -e /sys/devices/virtual/bdi/default/read_ahead_kb ]; then
echo "2048" > /sys/devices/virtual/bdi/default/read_ahead_kb;
fi;

SDCARDREADAHEAD=`ls -d /sys/devices/virtual/bdi/179*`;
for i in $SDCARDREADAHEAD; do
echo "2048" > $i/read_ahead_kb;
done;

echo "15" > /proc/sys/fs/lease-break-time;

log -p i -t $FILE_NAME "*** filesystem tweaks ***: enabled";
}

KERNEL_TWEAKS()
{
echo "1" > /proc/sys/vm/oom_kill_allocating_task;
echo "524288" > /proc/sys/fs/file-max;
echo "32000" > /proc/sys/fs/inotify/max_queued_events;
echo "256" > /proc/sys/fs/inotify/max_user_instances;
echo "10240" > /proc/sys/fs/inotify/max_user_watches;
echo "10" > /proc/sys/fs/lease-break-time;
echo "1048576" > /proc/sys/fs/nr_open;
echo "30" > /proc/sys/kernel/panic;
echo "0" > /proc/sys/kernel/panic_on_oops;
echo "64" > /proc/sys/kernel/random/read_wakeup_threshold;
echo "128" > /proc/sys/kernel/random/write_wakeup_threshold;
echo "0" > /proc/sys/kernel/sched_child_runs_first;
echo "5" > /proc/sys/kernel/sched_latency_ns;
echo "1" > /proc/sys/kernel/sched_min_granularity_ns;
echo "1" > /proc/sys/kernel/sched_wakeup_granularity_ns;
echo "134217728" > /proc/sys/kernel/shmmax;
echo "704512" > /proc/sys/kernel/threads-max;
echo "500 512000 64 2048" > /proc/sys/kernel/sem;
echo "70" > /proc/sys/vm/dirty_background_ratio;
echo "1000" > /proc/sys/vm/dirty_expire_centisecs;
echo "90" > /proc/sys/vm/dirty_ratio;
echo "2000" > /proc/sys/vm/dirty_writeback_centisecs;
echo "2" > /proc/sys/vm/drop_caches;
echo "4096" > /proc/sys/vm/min_free_kbytes;
echo "1" > /proc/sys/vm/min_free_order_shift;
echo "1" > /proc/sys/vm/oom_kill_allocating_task;
echo "3" > /proc/sys/vm/page-cluster;
echo "1" > /proc/sys/vm/panic_on_oom;
echo "100" > /proc/sys/vm/swappiness;
echo "1" > /proc/sys/vm/vfs_cache_pressure;

sysctl -w vm.panic_on_oom=0;

log -p i -t $FILE_NAME "*** kernel tweaks ***: enabled";
}

SYSTEM_TWEAKS()
{
# enable Hardware Rendering
setprop video.accelerate.hw 1;
setprop debug.performance.tuning 1;
setprop debug.sf.hw 1;
setprop persist.sys.use_dithering 1;
setprop persist.sys.ui.hw true; # ->reported as problem maker in some roms.

# render UI with GPU
setprop hwui.render_dirty_regions false;
setprop windowsmgr.max_events_per_sec 120;
setprop profiler.force_disable_err_rpt 1;
setprop profiler.force_disable_ulog 1;

# Proximity tweak
setprop mot.proximity.delay 15;

# more Tweaks
setprop dalvik.vm.execution-mode int:jit;
setprop persist.adb.notify 0;
setprop pm.sleep_mode 1;

log -p i -t $FILE_NAME "*** system tweaks ***: enabled";
}

CPU_GOV_TWEAKS()
{
	SYSTEM_GOVERNOR=`cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor`;

if [ $SYSTEM_GOVERNOR == "abyssplug" ]; then
echo "70000" > /sys/devices/system/cpu/cpufreq/ondemand/sampling_rate;
echo "5" > /sys/devices/system/cpu/cpufreq/ondemand/hotplug_in_sampling_periods;
echo "15" > /sys/devices/system/cpu/cpufreq/ondemand/hotplug_out_sampling_periods;
echo "5" > /sys/devices/system/cpu/cpufreq/abyssplug/down_differential;
echo "50" > /sys/devices/system/cpu/cpufreq/abyssplug/down_threshold;
echo "80" > /sys/devices/system/cpu/cpufreq/abyssplug/up_threshold;
fi;

	if [ $SYSTEM_GOVERNOR == "pegasusq" ]; then
echo "80000" > /sys/devices/system/cpu/cpufreq/pegasusq/sampling_rate;
echo "80" > /sys/devices/system/cpu/cpufreq/pegasusq/up_threshold;
echo "2" > /sys/devices/system/cpu/cpufreq/pegasusq/sampling_down_factor;
echo "5" > /sys/devices/system/cpu/cpufreq/pegasusq/down_differential;
echo "30" > /sys/devices/system/cpu/cpufreq/pegasusq/freq_step;
echo "80" > /sys/devices/system/cpu/cpufreq/pegasusq/up_threshold_at_min_freq;
echo "200000" > /sys/devices/system/cpu/cpufreq/pegasusq/freq_for_responsiveness;
echo "0" > /sys/devices/system/cpu/cpufreq/pegasusq/max_cpu_lock;
echo "0" > /sys/devices/system/cpu/cpufreq/pegasusq/dvfs debug;
echo "0" > /sys/devices/system/cpu/cpufreq/pegasusq/hotplug_lock;
echo 800000 > /sys/devices/system/cpu/cpufreq/pegasusq/hotplug_freq_1_1;
echo 400000 > /sys/devices/system/cpu/cpufreq/pegasusq/hotplug_freq_2_0;
echo 500000 > /sys/devices/system/cpu/cpufreq/pegasusq/hotplug_freq_2_1;
echo 400000 > /sys/devices/system/cpu/cpufreq/pegasusq/hotplug_freq_3_0;
echo 800000 > /sys/devices/system/cpu/cpufreq/pegasusq/hotplug_freq_3_1;
echo 500000 > /sys/devices/system/cpu/cpufreq/pegasusq/hotplug_freq_4_0;
echo 200 > /sys/devices/system/cpu/cpufreq/pegasusq/hotplug_rq_1_1;
echo 150 > /sys/devices/system/cpu/cpufreq/pegasusq/hotplug_rq_2_0;
echo 250 > /sys/devices/system/cpu/cpufreq/pegasusq/hotplug_rq_2_1;
echo 300 > /sys/devices/system/cpu/cpufreq/pegasusq/hotplug_rq_3_0;
echo 400 > /sys/devices/system/cpu/cpufreq/pegasusq/hotplug_rq_3_1;
echo 400 > /sys/devices/system/cpu/cpufreq/pegasusq/hotplug_rq_4_0;
fi;
}

MEMORY_TWEAKS()
{
echo "$dirty_expire_centisecs_default" > /proc/sys/vm/dirty_expire_centisecs;
echo "$dirty_writeback_centisecs_default" > /proc/sys/vm/dirty_writeback_centisecs;
echo "15" > /proc/sys/vm/dirty_background_ratio; # default: 10
echo "20" > /proc/sys/vm/dirty_ratio; # default: 20
echo "4" > /proc/sys/vm/min_free_order_shift; # default: 4
echo "0" > /proc/sys/vm/overcommit_memory; # default: 0
echo "1000" > /proc/sys/vm/overcommit_ratio; # default: 50
echo "128 128" > /proc/sys/vm/lowmem_reserve_ratio;
echo "3" > /proc/sys/vm/page-cluster; # default: 3
echo "4096" > /proc/sys/vm/min_free_kbytes;
echo "65530" > /proc/sys/vm/max_map_count;
echo "250 32000 32 128" > /proc/sys/kernel/sem; # default: 250 32000 32 128
echo "0,0,0,1,1,2" > /sys/module/lowmemorykiller/parameters/adj;

log -p i -t $FILE_NAME "*** memory tweaks ***: enabled";
}

OTHER_TWEAKS(){



	# enable NMI Watchdog to detect hangs
if [ -e /proc/sys/kernel/nmi_watchdog ]; then
echo "1" > /proc/sys/kernel/nmi_watchdog;
fi;

# fs settings
echo "25" > /proc/sys/vm/vfs_cache_pressure;

# process priority modifications
(
for i in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20;do
sleep 5;
renice 15 `pidof kswapd0`;
renice 3 `pidof android.process.acore`;
renice 3 `pidof android.process.media`;
renice -10 `pidof com.sec.android.app.launcher`;
renice -10 `pidof com.anddoes.launcher`;
renice -10 `pidof com.teslacoilsw.launcher`;
renice -10 `pidof com.sec.android.inputmethod`;
renice -10 `pidof com.cootek.smartinputv5`;
renice -10 `pidof com.swype.android.inputmethod`;
done;
)&
}
#�s akkor alkalmazzuk a be�ll�t�sokat

#PERSEUS_TWEAKS;
IO_TWEAKS;
KERNEL_TWEAKS;
SYSTEM_TWEAKS;
CPU_GOV_TWEAKS;
MEMORY_TWEAKS;
OTHER_TWEAKS;
